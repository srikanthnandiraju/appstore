<style>
    /* #photo-wrapper {
        width: 100%;
        height: 100%;
    }
    
    .photo-flexy {
        display: flex;
        justify-content: center;
        align-items: center;
        transition: all 2s;
        z-index: 999999;
    } */
</style>

<div id="photo-wrapper" class="photo-flexy" style="margin-top:100px;z-index: 999999;">
    <div class="ui segment padded raised animated fadeInUp" style="width:380px;">
        <div style="width:200px;margin:auto;text-align:center;position:relative">
            <img src="img/placeholder.png" style="max-height:100px;margin:auto;margin-bottom:10px" id="camera-image">
            <span id="remove-image" class="ui label left pointing red" style="position:absolute;top:10px;">X</span>
        </div>

        <div class="ui form">

            <div class="field">
                <textarea rows="4" id="message-text" placeholder="Enter message"></textarea>
            </div>

            <div class="ui icon message" id="loading-icon">
                <i class="notched circle loading icon"></i>
                <div class="content">
                    <div class="header">
                        Uploading image
                    </div>
                    <p>in few moments</p>
                </div>
            </div>

            <div class="field" id="admin-options">
                <div class="ui toggle checkbox" id="make-announcement">
                    <input type="checkbox" name="public">
                    <label>Mark as Announcement</label>
                </div>
            </div>

            <!-- <div class="field">
                <div class="ui fluid multiple search selection dropdown booth-tags">
                    <input name="tags" type="hidden" id="hash-tags">
                    <i class="dropdown icon"></i>
                    <div class="default text">#tag</div>
                    <div class="menu">
                        <div class="item" data-value="hwlabs">#hwlabs</div>
                        <div class="item" data-value="ui">#ui</div>
                        <div class="item" data-value="infosec">#infosec</div>
                        <div class="item" data-value="risk">#risk</div>
                    </div>
                </div>
            </div> -->

            <div class="field center aligned">
                <div style="text-align:center;">
                    <button class="ui button tiny teal" id="add-feed-image-button">Add Image</button>
                    <button class="ui button tiny green" id="submit-feed-button">Submit</button>
                </div>
            </div>

        </div>
    </div>
</div>

<script type="text/javascript">
    var feed_image = "";

    $(function () {

        var flagged_as_announcement = 0;

        $(".close").show();
        $("#remove-image").hide();
        $("#camera-image").hide();
        $("#loading-icon").hide();
        $("#admin-options").hide();

        if (App.User.type == "1") {
            $("#admin-options").show();
            $("#make-announcement").checkbox({
                onChange: function () {
                    var $input = $(this);
                    var checked = $input.is(":checked");
                    if (checked) {
                        flagged_as_announcement = 1;
                        // alert("Checked");
                    } else {}
                }
            });
        }

        // $(".booth-tags").dropdown({
        //     allowAdditions: true
        // });


        $("#submit-feed-button").click(function () {
            //var htags = $(".booth-tags").dropdown("get value");
            var enteredText = $("#message-text").val().trim();

            var feed_item = {
                user_id: App.User.id,
                user_name: App.User.firstname + " " + App.User.lastname,
                text: enteredText,
                likes: 0,
                rating: 0,
                tags: "",
                announcement: flagged_as_announcement,
                image: feed_image
            }

            App.Events.emit("create-feed-api", feed_item);
            App.Events.emit("show-new-feed", feed_item);

        });

        $("#add-feed-image-button").click(function () {
            feed_image = "";
            $("#remove-image").show();
            $("#camera-image").show();
            takeCameraImage();
        });

        $("#remove-image").click(function () {
            feed_image = undefined;
            App.Events.emit("remove-feed-image", "image name");
            $("#remove-image").hide();
            $("#camera-image").hide();
        });


        function takeCameraImage() {
            navigator.camera.getPicture(captureSuccess, captureError, {
                quality: 30,
                destinationType: Camera.DestinationType.FILE_URI
            });
        }

        function captureError(error) {
            var msg = 'An error occurred during capture: ' + error.code;
            feed_image = undefined;
            //alert(msg);
        }

        function captureSuccess(mediaFile) {
            feed_image = mediaFile;
            $("#camera-image").attr("src", mediaFile);
            uploadFile(mediaFile);
        }

        function uploadFile(imageURI) {
            $("#loading-icon").show();
            //alert("URL OF IMAGE " + JSON.stringify(imageURI));
            var options = new FileUploadOptions();
            options.fileKey = "feedImage";
            options.fileName = imageURI.substr(imageURI.lastIndexOf('/') + 1);
            options.mimeType = "image/jpeg";
            var params = new Object();
            options.params = params;
            options.chunkedMode = false;
            var ft = new FileTransfer();
            ft.upload(imageURI, App.serverURL + "/upload/images", function (result) {
                    var imgName = JSON.parse(result.response);
                    feed_image = App.serverURL + "/" + imgName.file;
                    //$("#message-text").append(feed_image);
                    //alert(feed_image);
                    $("#loading-icon").hide();
                    $("#loading-icon").empty();
                },
                function (error) {
                    $("#loading-icon").hide();
                    alert("Error Uploading. Please enable F5 VPN connection.");
                },
                options);
        }


    });
</script>