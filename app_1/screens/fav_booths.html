<style>
    #favs-screen-wrapper {
        position: absolute;
        margin: 0px;
        /* border: 2px solid red; */
        top: 1px;
        left: 0px;
        bottom: 0px;
        right: 0px;
        overflow: hidden;
        overflow-y: scroll;
        -webkit-overflow-scrolling: touch;
    }
</style>

<div id="favs-screen-wrapper">
    <div class="ui container">
        <br>
        <div id="all-booths-view" class="ui  cards"></div>
    </div>
</div>

<template id="fav-booths-view-template">
    {{#fav_booths}}


    <div class="ui fluid card animated fadeInDown" style="margin:15px;border-radius:10px;box-shadow:0px 6px 12px rgba(0,0,0,0.12);">

        <div class="content">
            <div class="header" style="margin-bottom:10px;">{{name}}
            </div>

            <img src="{{image}}" style="border-radius:8px;width:100%;margin-bottom:10px;">
            <div class="ui right aligned" style="margin-top:-50px;margin-right:10px;">
                <span style="border-radius:5px;background:rgba(0,0,0,0.5);color:white;padding:5px 10px;">BOOTH
                    {{number}}
                </span>
            </div>
            <br>
            <br>
            <div class="meta">
                <span class="time right floated">
                    <i class="map marker alternate icon"></i>&nbsp;&nbsp;{{location}}</span>

                <span class="time ">
                    <i class="clock outline icon"></i>&nbsp;&nbsp;{{date_of_event}}</span>
            </div>
            <div class="meta">
                <span class="time">
                    <i class="map signs icon"></i>&nbsp;&nbsp;{{zone}}</span>
                <br>
            </div>
            <div class="description">
                <br>
                <p class="header-x">
                    {{description}}
                </p>
            </div>

        </div>

        <div class="extra content">

            <div class="ui heart big rating like-booth left floated" data-booth-id="{{id}}" data-max-rating="1"
                data-rating="{{liked}}"></div>
            <span class="left floated" style="margin-top:-3px;margin-left:4px;"> Like</span>

            <span class="right floated remove-booth" style="margin-top:-3px;margin-left:4px;" data-booth-id="{{id}}"><i
                    class="trash alternate outline icon"></i>Remove</span>

        </div>

    </div>

    </div>

    {{/fav_booths}}
</template>

<script type="text/javascript" charset="utf-8">
    $(function () {

        if (isMobile.Android()) {
            document.getElementById('all-booths-view').style.paddingLeft = "10px";
        };


        $.getJSON(App.apiURL + "/boothactivity/fetch/" + App.User.id, function (result) {
            UserActivity.items = result.payload.data;
            renderFavListUI();
        });


        function renderFavListUI() {

            var savedItems = UserActivity.getSavedItems();

            if (!savedItems || savedItems.length < 1) {
                $("#all-booths-view").empty();
                $("#all-booths-view").html(App.Utils.getMessageTemplate({
                    icon_name: "star yellow",
                    main_text: "No Favourite booths found",
                    sub_text: "Click on he favourite icon on the booth to save to favourite list."
                }));
                return;
            }
            $("#all-booths-view").empty();


            var savedBooths = [];
            for (var i = 0; i < savedItems.length; i++) {
                var oneBooth = App.Booths.findBooth(savedItems[i].booth_id);
                oneBooth.date_of_event = oneBooth.day == "D2" ? "September 13th" : "September 12th";
                if (oneBooth.image == undefined || oneBooth.image == "")
                    oneBooth.image = "img/pypl_conf.gif";

                savedBooths.push(oneBooth);
            }

            let template = $('#fav-booths-view-template').html();
            let html = Mustache.to_html(template, {
                fav_booths: savedBooths
            });
            $('#all-booths-view').html(html);
            $(".rating").rating();
            registerEvents();
        }

        function registerEvents() {
            $('.like-booth').on('click', function () {
                var likeBoothId = parseInt($(this).attr("data-booth-id"));
                var isSelected = $(this).attr("data-rating");
                UserActivity.likedBooth(likeBoothId, 1);
            });
            $('.remove-booth').on('click', function () {
                var removeBoothId = parseInt($(this).attr("data-booth-id"));
                var isSelected = $(this).attr("data-rating");
                UserActivity.savedBooth(removeBoothId, 0);
                renderFavListUI();
            });
        }

        // renderFavListUI();

    });
</script>