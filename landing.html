<style>
    #home-screen-wrapper {
        position: absolute;
        margin: 0px;
        /* border: 2px solid red; */
        top: 1px;
        left: 0px;
        bottom: 0px;
        right: 0px;
        overflow: hidden;
        overflow-y: scroll;
        -webkit-overflow-scrolling: touch;
    }
    
    .scrolling-wrapper-flexbox {
        display: flex;
        flex-wrap: nowrap;
        overflow: hidden;
        overflow-x: auto;
        .scrolling-element {
            flex: 0 0 auto;
            margin-right: 3px;
        }
    }
    
    .scrolling-wrapper-flexbox {
        width: 100%;
        padding: 12px 0px;
        -webkit-overflow-scrolling: touch;
        &::-webkit-scrollbar {
            display: none;
        }
    }
    
    .scroll-card {
        width: 200px;
        height: 100px;
        margin: 0px 10px !important;
        /* box-shadow: 0px 3px 15px rgba(0, 0, 0, 0.3) !important; */
    }
    
    .news-card {
        /* border: 1px solid #fff !important; */
        box-shadow: 0px 3px 15px rgba(0, 0, 0, 0.3) !important;
        border-radius: 8px !important;
        color: white;
        font-weight: bold;
        height: 130px;
        /* background: linear-gradient(to top left, #1976d2, #2196f3) !important; */
        background: linear-gradient(to bottom right, #00CF92, #009CDE) !important;
        /* background: white !important; */
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    .upcoming-event-card {
        /* border: 1px solid #fff !important; */
        cursor: pointer;
        border-radius: 8px !important;
        color: white;
        height: 150px;
        width: 200px;
        padding-bottom: 10px !important;
        /* background: linear-gradient(to top left, #1976d2, #2196f3) !important; */
        /* background: linear-gradient(to bottom right, #00CF92, #009CDE) !important; */
        /* background: white !important; */
        /* display: flex;
        justify-content: center;
        align-items: center; */
    }
    
    .ellipsis {
        overflow: hidden;
        // white-space: nowrap;
        text-overflow: ellipsis;
    }
    
    #news-items-holder::-webkit-scrollbar {
        display: none;
    }
    
    #upcoming-items-holder::-webkit-scrollbar {
        display: none;
    }
    
    #news-items-holder {
        transition: all 1s ease-in-out;
    }
</style>
<div id="home-screen-wrapper">
    <img class="animated fadeInDown" src="img/pyplsjc.jpg" alt="" width="100%">
    <div class="ui container">
        <h3 class="ui header" style="margin-top:20px;">
            PayPal In the news
            <div class="sub header">Latest news coverage on PayPal.</div>
        </h3>
        <div class="scrolling-wrapper-flexbox" id="news-items-holder">
        </div>

        <h3 class="ui header">
            Upcomming Events
            <div class="sub header">In your location, SJC.</div>
        </h3>
        <div class="scrolling-wrapper-flexbox" id="upcoming-items-holder">
            <button class="ui button red" onclick="App.Events.emit('show-haloween-app')">Expo SJC</button>
        </div>

        <h3 class="ui header">
            Past Events
            <div class="sub header">Past events on campus.</div>
        </h3>
        <div class="scrolling-wrapper-flexbox" id="items-holder-1">
            <button class="ui button green" onclick="App.Events.emit('show-india-app')">India Expo</button>
        </div>
    </div>
</div>

<template id="items-template">
    {{#items}}
    <div class="scrolling-element">
        <div class="ui segment scroll-card">
            <div class="ui header">{{time_lapsed}}</div>
            {{text}}
        </div>
    </div>
    {{/items}}
</template>

<template id="news-items-template">
    {{#items}}
    <div class="scrolling-element">
        <div class="ui basic teal segment center aligned middle aligned scroll-card news-card" data-link-url="{{feedlink}}">
            <!-- <img src="{{image}}" style="height:50px;margin:auto;"> -->
            <p class="ellipsis">
                {{title}}
            </p>
        </div>
    </div>
    {{/items}}
</template>

<template id="upcoming-items-template">
    {{#items}}
    <div class="scrolling-element">
        <div class="ui basic segment scroll-card upcoming-event-card {{grad}}" data-link-url="{{feedlink}}">
            <h4 class="ui header inverted">
                <img src="{{image}}" width="60" style="margin-bottom:20px;">
                <br> {{{name}}}
                <div class="sub header">{{date}}</div>
            </h4>
        </div>
    </div>
    {{/items}}
</template>

<script>
    App.feedData = {};
    var grads = ["red-grad", "blue-grad", "gray-grad", "lime-grad", "pink-grad"];

    function getRandomClass() {
        var rind = getRandomArbitrary(0, grads.length - 1);
        // console.log(rind);
        return grads[rind];
    }

    function getRandomArbitrary(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function loadData(text) {
        var skey = "'" + escape(text) + "'";
        if (App.feedData[skey] != undefined) {
            var itemsFound = App.feedData[skey];
            renderView(itemsFound);
        } else {
            text = encodeURI(text);
            var yql = encodeURIComponent(
                "select * from xml where url='https://news.google.com/news/rss/search/section/q/" +
                text +
                "/?ned=us&gl=US&hl=en'"
            );
            var modifiedItems = [];
            $.getJSON(
                "https://query.yahooapis.com/v1/public/yql?q=" +
                yql +
                "&format=json&callback=?",
                function(data) {
                    if (!data.query.results.rss.channel.item ||
                        data.query.results.rss.channel.item.length < 1) {
                        alert("No data found");
                        return;
                    }
                    var items = data.query.results.rss.channel.item;
                    $.each(items, function(i, item) {
                        var oneItem = {
                            feedlink: item.link,
                            title: item.title, // time_lapsed: //
                            // moment(item.pubDate).fromNow(),
                            date: item.pubDate,
                            description: $(item.description).text(),
                            richDescription: item.description,
                            bgColor: getRandomClass(),
                            col2: $(item.description).find("td:first-child+td").html(),
                            image: $(item.description)
                                .find("img:first").attr("src")
                        };
                        modifiedItems.push(oneItem);
                    });
                    modifiedItems.sort(function(a, b) {
                        return new
                        Date(b.date) - new Date(a.date);
                    });

                    App.feedData[skey] = modifiedItems;
                    renderView(modifiedItems);
                });
        }
    }

    function renderView(items) {
        let template = $("#news-items-template").html();
        let html = Mustache.to_html(template, {
            items: items
        });
        $("#news-items-holder").html(html);
        $(".news-card").click(function(e) {
            var link = $(this).attr("data-link-url");
            //alert(link);
            App.Utils.showInBrowser(link);
        });
    }

    function renderUpcomingEvents() {
        var upcoming_events = [{
            image: "https://www.freeiconspng.com/uploads/halloween-png-28.png",
            name: "Haloween Bake Off & Haunted hoouse",
            date: "10/01/2018",
            grad: "slate-grad"
        }, {
            image: "https://dumielauxepices.net/sites/default/files/light-clipart-deepavali-665045-3387561.png",
            name: "PayPal Employee <br> Diwali party",
            date: "10/15/2018",
            grad: "red-grad"
        }, {
            image: "https://melbournechapter.net/images/technology-transparent-icon-5.png",
            name: "PayPal India <br>Chennai Tech Expo",
            date: "10/25/2018",
            grad: "blue-grad"
        }];
        let template = $("#upcoming-items-template").html();
        let html = Mustache.to_html(template, {
            items: upcoming_events
        });
        $("#upcoming-items-holder").html(html);
    }

    $(function() {
        App.Events.listen("show-haloween-app", function() {
            App.base_url = App.store_url + "texposjc";
            $.getScript(App.base_url + "/js/init.js", function(jd) {
                alert("Loaded new path");
            });

            // $.ajax({
            //     type: "GET",
            //     url: App.base_url + "/js/init.js",
            //     success: function() {
            //         alert("Loaded new path");
            //     },
            //     dataType: "script",
            //     cache: true
            // });

        });

        App.Events.listen("show-india-app", function() {
            App.base_url = App.store_url + "india";
            $.getScript(App.base_url + "/js/init.js", function(jd) {
                alert("Loaded india path");
            });
        });
        loadData("PayPal");


        renderUpcomingEvents();
    });
</script>